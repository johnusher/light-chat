# light-chat
Chat-GPT enabled control of a strip of programmable LEDs using a text or voice prompt. For speech to text we use the OpenAI Whisper API. To program the LEDs we use an Arduino. The user prompt will generate new Arduino code to modify the existing light pattern or to generate a new pattern.

This is a Golang and Arduino project using the Go openAI interface library [https://github.com/sashabaranov/go-openai](https://github.com/sashabaranov/go-openai) and the FastLED library [https://github.com/FastLED](https://github.com/FastLED).

The project has been tested with Windows OS.



# Useage
The main file is [light_chat_main.go](light_chat_main.go)

It determines if an Arduino is connected via USB, what COM port it is connected to, and what board type it is (atmega328 or Uno).

Command line execution:  <br /> 
go run .\light_chat_main.go <br /> 

flags:<br /> 
-p "make lights kinda blue"= text prompt input. If we do not use this flag then we default to use voice input with the default microphone.<br /> 
-r (bool) reset the reference (provided example) light pattern code to [xmasTwinkleDuino.c](xmasTwinkleDuino.c). This file contains information about the programable LED strip chipset (currently WS2812B), the number of LEDs on the strip, and which Arduino pin to use for the data output.<br /> 
If the flag is not used, the reference (provided example) light pattern code is [duinoCode.ino](duinoCode/duinoCode.ino).<br /> 
In summary: Use this -r flag when you want to reset the light pattern and make a new one (e.g. "make a new calm light pattern that is a poem by John Donne"). Otherwise do not use the flag to modify whatever the exisiting pattern is (e.g. "make the light pattern less romantic"). <br /> 
 -nb (bool) = no board. Use this flag if no Arduino is connected but you still want to generate a response that is saved in directory [responseHistory](responseHistory).  <br /> 

# Examples

### 1.
```
go run .\light_chat_main.go -p "Make the colours suitable for a party 
at 420 wink-wink nudge-nudge say no more" -nb -r 
```
This uses a text prompt input, with no Arduino board connected, and using the default reference code in xmasTwinkleDuino.c.

 The ChatGPT response is stored in directory [responseHistory](responseHistory) as a text file with filename the same as the user prompt for the light pattern -  [example for above](<responseHistory/Make the colours suitable for an adult 4-20 party nudge-nudge wink-wink say.txt>).<br /> 

 We add "response rules" to ask ChatGPT to describe how it interpretted the prompt. For the above example, this is the comment it generated on the code:<br /> 
```Your ChristmasLights function was replaced by the PartyLights function. The colours were changed from a repeating pattern of red, green, white to green and purple. For a 4-20 themed party these colours are more suitable as green often represents marijuana and purple represents the feeling of relaxation and royalty.```

### 2.
 ``` 
 go run .\light_chat_main.go -p "Now make the lights more romantic." -nb
 ```
This uses a text prompt input without the -r flag to modify the code generated by the previous response in the 1st example.<br /> 
This is the ChatGPT comment on the code:<br /> 

```
 The above code will create a "romantic" atmosphere by decreasing the brightness to a soft glow (80 out of 255). It also slows down the frame rate to a calm 2 frames per second. Most importantly, it sets all the LEDs to red (CHSV(0, 255, 255) is a hue-saturation-value representation of the color red), which is traditionally associated with romance.
 ```

### 3
```
I would like a monochrome black and white interpretation of the song Age of Aquarius
```

Response: [here](<responseHistory/I would like a monochrome black and white interpretation of the song Age of Aquarius.txt>)<br /> 
The C code did not compile- it used an undefined parameter HALF. But the response did not lack in ambition nor inventive interpretation :)

# How it works
1. Obtain desired new or ammended light pattern using a text or microphone recording and convert speech to text using the OpenAI Whisper api.
3. Create a new prompt to replace or update the light pattern accordingly.
4. Send new prompt to chatgpt.
5. Receive ChatGPT response, parse for valid Arduino C code.
6. Compile new light pattern and program Arduino (using Ardunio-CLI). 

# Setup the software environment

Download: <br /> 
golang (tested with 1.21.5 on Windows)

Arduino CLI

Install the go-openai library (provides unofficial Go clients for OpenAI API):

```
go get github.com/sashabaranov/go-openai
```



# ChatGPT

Pay $ for ChatGPT-API credit and store your private key somewhere eg ...//privateChatGPTAPIkey.txt

# Install Arduino libraries
Used library Version Path<br />
FastLED      3.6.0   C:\Users\jusher\Documents\Arduino\libraries\FastLED<br />

Used platform Version Path<br />
arduino:avr   1.8.6   C:\Users\jusher\AppData\Local\Arduino15\packages\arduino\hardware\avr\1.8.6<br />

# Useful files
[duinoHelp.txt](duinoCode/duinoHelp.md)


# Problems, TODOs, comments

We sometimes get invalid code. We can use the response from ```arduino-cli compile ``` to extract error messages and resend this to ChatGPT to try and get revised and working code.<br />
Some colours look bad with RGB LEDS- e.g. brown and yellow, and white if no white LED.<br />
It cost about 0.6 cents for each prompt using ChatGPT4. The WhisperAPI is <0.1C per 10 second prompt.<br />
The winmm.dll is pretty janky and about 1 in 10 times the microphone recording will not work: need to switch to using core-audio (for Linux compatability).


# Credits

Nimrod Gileadi for the idea of including example code in the response and encouragement:  [https://github.com/nimrod-gileadi](https://github.com/nimrod-gileadi) <br /> 
Some of the prompt engineering suffix (the "response rules") were taken from a paper he worked on (Wenhao Yu, Nimrod Gileadi, et al. Language to rewards for robotic skill synthesis. arXiv preprint arXiv:2306.08647, 2023).<br />
Siggy for golang help: [https://sig.gy/](https://sig.gy/) <br />
The Arduino project (try to buy at least one legit product!) :[https://www.arduino.cc/](https://www.arduino.cc/) <br />  



